{% extends "base.html" %}

{% block title %}A/B测试 - 活动对比效果预测{% endblock %}

{% block content %}
<!-- 页面头部 -->
<section class="page-header">
    <div class="breadcrumb">
        <a href="{{ url_for('index') }}">首页</a>
        <span>/</span>
        <span>活动效果预测</span>
        <span>/</span>
        <span>A/B测试</span>
    </div>
    
    <div class="page-header-content">
        <div class="page-icon" style="--platform-color: #6b46c1">🔬</div>
        <div>
            <h1 class="page-title">A/B测试 - 活动对比效果预测</h1>
            <p class="page-desc">对比两种活动形式，预测哪个效果更好</p>
        </div>
    </div>
</section>

<!-- 公式卡片 -->
<section class="formulas-section">
    <div class="formula-card" id="ab_test">
        <!-- 公式头部 -->
        <div class="formula-header">
            <div class="formula-title-group">
                <h2 class="formula-name">活动效果对比评分</h2>
                <span class="formula-english">A/B Test Comparison</span>
            </div>
        </div>

        <!-- 公式内容区 -->
        <div class="formula-body ab-test-body">
            <!-- 左侧：公式说明 -->
            <div class="formula-info">
                <!-- 公式表达式 -->
                <div class="formula-expression">
                    <div class="expression-label">计算公式</div>
                    <div class="expression-content">综合评分 = 销售额 × 权重1 + 转化率 × 权重2 + 客单价 × 权重3</div>
                </div>

                <!-- 公式说明 -->
                <div class="formula-description">
                    <h4 class="info-label">📖 公式说明</h4>
                    <p>通过对不同活动的核心指标进行加权计算，得出综合评分。评分越高，说明该活动效果越好。</p>
                    <ul class="formula-notes">
                        <li><strong>销售额</strong>：活动期间的销售额总和</li>
                        <li><strong>转化率</strong>：活动期间的平均转化率</li>
                        <li><strong>客单价</strong>：活动期间的平均客单价</li>
                        <li><strong>权重</strong>：根据业务重点设置，数值越大表示该指标越重要</li>
                    </ul>
                </div>

                <!-- 应用场景 -->
                <div class="formula-application">
                    <h4 class="info-label">💡 应用场景</h4>
                    <p>当有两种活动形式，不知道使用哪种活动时，可提供相关数据作为预测效果参考。</p>
                    <p>例如：对比"两件八折"和"直降10元"哪个效果更好。</p>
                </div>

                <!-- 示例数据 -->
                <div class="formula-example">
                    <h4 class="info-label">📊 示例</h4>
                    <div class="ab-example">
                        <div class="ab-example-scenario">
                            <p><strong>场景：</strong>在所有客户中随机抽取两组客户，分别测试两种活动</p>
                        </div>
                        <div class="ab-example-data">
                            <div class="ab-example-group">
                                <h5>活动A：两件八折</h5>
                                <p>销售额：50,000元</p>
                                <p>转化率：3.5%</p>
                                <p>客单价：180元</p>
                            </div>
                            <div class="ab-example-group">
                                <h5>活动B：直降10元</h5>
                                <p>销售额：45,000元</p>
                                <p>转化率：4.2%</p>
                                <p>客单价：150元</p>
                            </div>
                        </div>
                        <div class="ab-example-weight">
                            <p><strong>权重设置：</strong>销售额权重=5，转化率权重=3，客单价权重=2</p>
                        </div>
                        <div class="ab-example-calc">
                            <p><strong>计算结果：</strong></p>
                            <p>活动A评分 = 50000×5 + 3.5×3 + 180×2 = 250,370.5</p>
                            <p>活动B评分 = 45000×5 + 4.2×3 + 150×2 = 225,312.6</p>
                            <p class="result-note success">结论：活动A（两件八折）效果更好</p>
                        </div>
                    </div>
                </div>

                <!-- 注意事项 -->
                <div class="formula-critical">
                    <h4 class="info-label">⚠️ 注意事项</h4>
                    <div class="critical-content">
                        <ul class="formula-notes">
                            <li>确保两组测试样本数量相近，避免样本偏差</li>
                            <li>测试时间应一致，避免时间因素影响</li>
                            <li>权重设置应根据业务目标调整，如追求销量则提高销售额权重</li>
                            <li>此评分仅供参考，实际决策需结合其他因素</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 右侧：计算器 -->
            <div class="formula-calculator ab-calculator">
                <h4 class="calculator-title">🧮 在线计算</h4>
                <form class="calculator-form" id="ab-test-form">
                    <!-- 活动A数据 -->
                    <div class="ab-group">
                        <h5 class="ab-group-title">📊 活动A数据</h5>
                        <div class="input-group">
                            <label for="a_sales">销售额总和</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="a_sales" 
                                       name="a_sales"
                                       class="calc-input"
                                       placeholder="请输入"
                                       step="0.01"
                                       min="0">
                                <span class="input-unit">元</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="a_cvr">转化率平均值</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="a_cvr" 
                                       name="a_cvr"
                                       class="calc-input"
                                       placeholder="请输入"
                                       step="0.01"
                                       min="0">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="a_aov">客单价平均值</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="a_aov" 
                                       name="a_aov"
                                       class="calc-input"
                                       placeholder="请输入"
                                       step="0.01"
                                       min="0">
                                <span class="input-unit">元</span>
                            </div>
                        </div>
                    </div>

                    <!-- 活动B数据 -->
                    <div class="ab-group">
                        <h5 class="ab-group-title">📊 活动B数据</h5>
                        <div class="input-group">
                            <label for="b_sales">销售额总和</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="b_sales" 
                                       name="b_sales"
                                       class="calc-input"
                                       placeholder="请输入"
                                       step="0.01"
                                       min="0">
                                <span class="input-unit">元</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="b_cvr">转化率平均值</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="b_cvr" 
                                       name="b_cvr"
                                       class="calc-input"
                                       placeholder="请输入"
                                       step="0.01"
                                       min="0">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="b_aov">客单价平均值</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="b_aov" 
                                       name="b_aov"
                                       class="calc-input"
                                       placeholder="请输入"
                                       step="0.01"
                                       min="0">
                                <span class="input-unit">元</span>
                            </div>
                        </div>
                    </div>

                    <!-- 权重设置 -->
                    <div class="ab-group">
                        <h5 class="ab-group-title">⚖️ 权重设置</h5>
                        <div class="input-group">
                            <label for="w_sales">销售额权重</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="w_sales" 
                                       name="w_sales"
                                       class="calc-input"
                                       placeholder="如：5"
                                       step="0.1"
                                       min="0"
                                       value="5">
                                <span class="input-unit"></span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="w_cvr">转化率权重</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="w_cvr" 
                                       name="w_cvr"
                                       class="calc-input"
                                       placeholder="如：3"
                                       step="0.1"
                                       min="0"
                                       value="3">
                                <span class="input-unit"></span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="w_aov">客单价权重</label>
                            <div class="input-wrapper">
                                <input type="number" 
                                       id="w_aov" 
                                       name="w_aov"
                                       class="calc-input"
                                       placeholder="如：2"
                                       step="0.1"
                                       min="0"
                                       value="2">
                                <span class="input-unit"></span>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="calc-button" onclick="calculateABTest()">
                        计算结果
                    </button>
                    
                    <div class="calc-result ab-result" id="ab_result">
                        <span class="result-label">计算结果</span>
                        <div class="result-details">
                            <div class="result-item">
                                <span class="result-name">活动A评分</span>
                                <span class="result-value" id="result_a_score">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-name">活动B评分</span>
                                <span class="result-value" id="result_b_score">--</span>
                            </div>
                            <div class="result-item highlight">
                                <span class="result-name">推荐活动</span>
                                <span class="result-value" id="result_recommend">--</span>
                            </div>
                            <div class="result-item">
                                <span class="result-name">评分差异</span>
                                <span class="result-value" id="result_diff">--</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- 返回链接 -->
<section class="related-section">
    <h3 class="related-title">返回</h3>
    <div class="related-grid">
        <a href="{{ url_for('index') }}" class="related-card">
            <span class="related-icon">🏠</span>
            <span class="related-name">首页</span>
        </a>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
function calculateABTest() {
    // 获取活动A数据
    const aSales = parseFloat(document.getElementById('a_sales').value);
    const aCvr = parseFloat(document.getElementById('a_cvr').value);
    const aAov = parseFloat(document.getElementById('a_aov').value);
    
    // 获取活动B数据
    const bSales = parseFloat(document.getElementById('b_sales').value);
    const bCvr = parseFloat(document.getElementById('b_cvr').value);
    const bAov = parseFloat(document.getElementById('b_aov').value);
    
    // 获取权重
    const wSales = parseFloat(document.getElementById('w_sales').value);
    const wCvr = parseFloat(document.getElementById('w_cvr').value);
    const wAov = parseFloat(document.getElementById('w_aov').value);
    
    const resultDiv = document.getElementById('ab_result');
    const aScoreEl = document.getElementById('result_a_score');
    const bScoreEl = document.getElementById('result_b_score');
    const recommendEl = document.getElementById('result_recommend');
    const diffEl = document.getElementById('result_diff');
    
    // 验证输入
    const inputs = document.querySelectorAll('#ab-test-form .calc-input');
    let allFilled = true;
    
    inputs.forEach(input => {
        const value = parseFloat(input.value);
        if (isNaN(value) || input.value === '') {
            allFilled = false;
            input.classList.add('error');
        } else {
            input.classList.remove('error');
        }
    });
    
    if (!allFilled) {
        aScoreEl.textContent = '请填写所有字段';
        resultDiv.classList.add('error');
        resultDiv.classList.remove('success');
        return;
    }
    
    // 计算综合评分
    // 综合评分 = 销售额 × 权重1 + 转化率 × 权重2 + 客单价 × 权重3
    const aScore = aSales * wSales + aCvr * wCvr + aAov * wAov;
    const bScore = bSales * wSales + bCvr * wCvr + bAov * wAov;
    
    // 计算差异
    const diff = Math.abs(aScore - bScore);
    const diffPercent = ((diff / Math.min(aScore, bScore)) * 100).toFixed(2);
    
    // 确定推荐活动
    let recommend;
    if (aScore > bScore) {
        recommend = '活动A';
        recommendEl.classList.add('success-text');
        recommendEl.classList.remove('warning-text');
    } else if (bScore > aScore) {
        recommend = '活动B';
        recommendEl.classList.add('success-text');
        recommendEl.classList.remove('warning-text');
    } else {
        recommend = '效果相当';
        recommendEl.classList.add('warning-text');
        recommendEl.classList.remove('success-text');
    }
    
    // 显示结果
    aScoreEl.textContent = aScore.toLocaleString('zh-CN', {maximumFractionDigits: 2});
    bScoreEl.textContent = bScore.toLocaleString('zh-CN', {maximumFractionDigits: 2});
    recommendEl.textContent = recommend;
    diffEl.textContent = diff.toLocaleString('zh-CN', {maximumFractionDigits: 2}) + ' (' + diffPercent + '%)';
    
    resultDiv.classList.remove('error');
    resultDiv.classList.add('success');
    
    // 动画效果
    resultDiv.classList.add('animate');
    setTimeout(() => resultDiv.classList.remove('animate'), 300);
}

// 输入框事件
document.querySelectorAll('#ab-test-form .calc-input').forEach(input => {
    input.addEventListener('input', function() {
        this.classList.remove('error');
        const resultDiv = document.getElementById('ab_result');
        resultDiv.classList.remove('success', 'error');
    });
    
    input.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            calculateABTest();
        }
    });
});
</script>
{% endblock %}

{% set platforms = platforms %}
{% set metrics = metrics %}






