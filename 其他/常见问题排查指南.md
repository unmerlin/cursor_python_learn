# å¸¸è§é—®é¢˜æ’æŸ¥æŒ‡å—

> Flask é¡¹ç›®éƒ¨ç½²è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

---

## ğŸ“Œ çŸ¥è¯†ç‚¹è¯´æ˜

- ğŸ”´ **ã€å¿…é¡»æŒæ¡ã€‘** - å¸¸è§é—®é¢˜ï¼Œå¿…é¡»äº†è§£è§£å†³æ–¹æ³•
- ğŸŸ¡ **ã€é‡è¦ã€‘** - ä¸­ç­‰é¢‘ç‡é—®é¢˜
- ğŸŸ¢ **ã€å¯é€‰ã€‘** - è¾ƒå°‘é‡åˆ°

---

## ä¸€ã€æœåŠ¡æ— æ³•å¯åŠ¨ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 1.1 Python æ¨¡å—æ‰¾ä¸åˆ°

**é”™è¯¯ä¿¡æ¯**
```
ModuleNotFoundError: No module named 'flask'
```

**åŸå› **ï¼šè™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»æˆ–ä¾èµ–æœªå®‰è£…

**è§£å†³æ–¹æ¡ˆ**
```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/ecommerce_knowledge

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é‡å¯æœåŠ¡
systemctl restart ecommerce
```

### 1.2 ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**
```
Address already in use
```

**è§£å†³æ–¹æ¡ˆ**
```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
ss -tlnp | grep 5000

# ç»“æŸè¿›ç¨‹
kill -9 è¿›ç¨‹PID

# é‡å¯æœåŠ¡
systemctl restart ecommerce
```

### 1.3 æƒé™ä¸è¶³

**é”™è¯¯ä¿¡æ¯**
```
PermissionError: [Errno 13] Permission denied
```

**è§£å†³æ–¹æ¡ˆ**
```bash
# ä¿®å¤ç›®å½•æƒé™
chown -R www-data:www-data /var/www/ecommerce_knowledge
chmod -R 755 /var/www/ecommerce_knowledge

# æ—¥å¿—ç›®å½•æƒé™
chown -R www-data:www-data /var/log/gunicorn
```

### 1.4 é…ç½®æ–‡ä»¶è·¯å¾„é”™è¯¯

**æ’æŸ¥æ­¥éª¤**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/www/ecommerce_knowledge/gunicorn_config.py

# æ‰‹åŠ¨è¿è¡Œæµ‹è¯•
cd /var/www/ecommerce_knowledge
source venv/bin/activate
gunicorn -c gunicorn_config.py app:app
```

---

## äºŒã€502 Bad Gateway ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

**è¯´æ˜**ï¼šNginx æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡

### 2.1 Gunicorn æœªè¿è¡Œ

**æ’æŸ¥**
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status ecommerce

# å¦‚æœæœªè¿è¡Œï¼Œå¯åŠ¨æœåŠ¡
systemctl start ecommerce

# æŸ¥çœ‹å¯åŠ¨é”™è¯¯
journalctl -u ecommerce -n 50
```

### 2.2 ç«¯å£ä¸åŒ¹é…

**æ’æŸ¥**
```bash
# æ£€æŸ¥ Gunicorn ç›‘å¬çš„ç«¯å£
ss -tlnp | grep gunicorn

# æ£€æŸ¥ Nginx é…ç½®çš„ä»£ç†ç«¯å£
cat /etc/nginx/sites-available/ecommerce | grep proxy_pass

# ç¡®ä¿ä¸¤è€…ä¸€è‡´ï¼ˆé»˜è®¤ 127.0.0.1:5000ï¼‰
```

### 2.3 Gunicorn è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**
```python
# gunicorn_config.py
timeout = 120  # å¢åŠ è¶…æ—¶æ—¶é—´
```

```bash
# é‡å¯æœåŠ¡
systemctl restart ecommerce
```

---

## ä¸‰ã€403 Forbidden ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

**è¯´æ˜**ï¼šæ²¡æœ‰æƒé™è®¿é—®èµ„æº

### 3.1 ç›®å½•æƒé™é—®é¢˜

```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la /var/www/ecommerce_knowledge/

# ä¿®å¤æƒé™
chmod 755 /var/www/ecommerce_knowledge
chmod -R 755 /var/www/ecommerce_knowledge/static
```

### 3.2 SELinux é—®é¢˜ï¼ˆCentOSï¼‰

```bash
# æ£€æŸ¥ SELinux çŠ¶æ€
getenforce

# ä¸´æ—¶å…³é—­
setenforce 0

# æ°¸ä¹…å…³é—­ï¼ˆéœ€é‡å¯ï¼‰
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
```

---

## å››ã€404 Not Found ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 4.1 é™æ€æ–‡ä»¶ 404

**æ’æŸ¥**
```bash
# æ£€æŸ¥é™æ€æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/www/ecommerce_knowledge/static/

# æ£€æŸ¥ Nginx é…ç½®
cat /etc/nginx/sites-available/ecommerce | grep -A2 "location /static"
```

**è§£å†³æ–¹æ¡ˆ**
```nginx
# ç¡®ä¿è·¯å¾„æ­£ç¡®
location /static {
    alias /var/www/ecommerce_knowledge/static;
}
```

### 4.2 è·¯ç”± 404

**æ’æŸ¥**
```bash
# æ£€æŸ¥ Flask åº”ç”¨è·¯ç”±
cd /var/www/ecommerce_knowledge
source venv/bin/activate
python -c "from app import app; print(app.url_map)"
```

---

## äº”ã€500 Internal Server Error ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 5.1 æŸ¥çœ‹é”™è¯¯æ—¥å¿—

```bash
# Gunicorn é”™è¯¯æ—¥å¿—
tail -50 /var/log/gunicorn/error.log

# æˆ–ä½¿ç”¨ journalctl
journalctl -u ecommerce -n 50

# Nginx é”™è¯¯æ—¥å¿—
tail -50 /var/log/nginx/error.log
```

### 5.2 å¸¸è§åŸå› 

**Python ä»£ç é”™è¯¯**
```bash
# æœ¬åœ°æµ‹è¯•
cd /var/www/ecommerce_knowledge
source venv/bin/activate
python app.py
```

**é…ç½®æ–‡ä»¶é”™è¯¯**
```bash
# æ£€æŸ¥ Python è¯­æ³•
python -m py_compile app.py
python -m py_compile gunicorn_config.py
```

**ç¼ºå°‘ç¯å¢ƒå˜é‡**
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat /etc/systemd/system/ecommerce.service | grep Environment
```

---

## å…­ã€SSL/HTTPS é—®é¢˜ ğŸŸ¡ã€é‡è¦ã€‘

### 6.1 è¯ä¹¦è·å–å¤±è´¥

**é”™è¯¯ä¿¡æ¯**
```
Challenge failed for domain
```

**åŸå› **ï¼šåŸŸåæœªæ­£ç¡®è§£æåˆ°æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ**
```bash
# æ£€æŸ¥åŸŸåè§£æ
ping ä½ çš„åŸŸå.com

# ç¡®ä¿ 80 ç«¯å£å¯è®¿é—®
curl http://ä½ çš„åŸŸå.com

# æ£€æŸ¥é˜²ç«å¢™
ufw status
```

### 6.2 è¯ä¹¦è¿‡æœŸ

```bash
# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
certbot certificates

# æ‰‹åŠ¨ç»­æœŸ
certbot renew

# é‡å¯ Nginx
systemctl restart nginx
```

### 6.3 æ··åˆå†…å®¹è­¦å‘Š

**è¯´æ˜**ï¼šHTTPS é¡µé¢åŠ è½½ HTTP èµ„æº

**è§£å†³æ–¹æ¡ˆ**
```python
# Flask ä¸­å¼ºåˆ¶ä½¿ç”¨ HTTPS
# åœ¨ app.py ä¸­æ·»åŠ 
from werkzeug.middleware.proxy_fix import ProxyFix
app.wsgi_app = ProxyFix(app.wsgi_app, x_proto=1)
```

---

## ä¸ƒã€æ€§èƒ½é—®é¢˜ ğŸŸ¡ã€é‡è¦ã€‘

### 7.1 å“åº”ç¼“æ…¢

**æ’æŸ¥**
```bash
# æ£€æŸ¥æœåŠ¡å™¨è´Ÿè½½
top

# æ£€æŸ¥å†…å­˜
free -h

# æ£€æŸ¥ç£ç›˜
df -h
```

**è§£å†³æ–¹æ¡ˆ**
```python
# gunicorn_config.py
workers = 4  # å¢åŠ å·¥ä½œè¿›ç¨‹
threads = 2  # æ·»åŠ çº¿ç¨‹
```

### 7.2 å†…å­˜ä¸è¶³

```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹è¿›ç¨‹å†…å­˜
ps aux --sort=-%mem | head -10
```

**è§£å†³æ–¹æ¡ˆ**
```python
# gunicorn_config.py
workers = 2  # å‡å°‘å·¥ä½œè¿›ç¨‹
max_requests = 1000  # å®šæœŸé‡å¯è¿›ç¨‹
```

---

## å…«ã€æ—¥å¿—ç›¸å…³ ğŸŸ¡ã€é‡è¦ã€‘

### 8.1 æ—¥å¿—æ–‡ä»¶ä¸ç”Ÿæˆ

**åŸå› **ï¼šæ—¥å¿—ç›®å½•ä¸å­˜åœ¨æˆ–æ— æƒé™

```bash
# åˆ›å»ºç›®å½•
mkdir -p /var/log/gunicorn

# è®¾ç½®æƒé™
chown www-data:www-data /var/log/gunicorn
```

### 8.2 æ—¥å¿—å ç”¨è¿‡å¤šç©ºé—´

```bash
# æ£€æŸ¥æ—¥å¿—å¤§å°
du -sh /var/log/gunicorn/
du -sh /var/log/nginx/

# æ¸…ç†æ—§æ—¥å¿—
journalctl --vacuum-size=500M
```

### 8.3 é…ç½®æ—¥å¿—è½®è½¬

```bash
# åˆ›å»º logrotate é…ç½®
nano /etc/logrotate.d/gunicorn
```

```
/var/log/gunicorn/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data www-data
    postrotate
        systemctl reload ecommerce
    endscript
}
```

---

## ä¹ã€Nginx é…ç½®é—®é¢˜ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 9.1 é…ç½®è¯­æ³•é”™è¯¯

```bash
# æµ‹è¯•é…ç½®
nginx -t

# å¦‚æœæŠ¥é”™ï¼Œæ£€æŸ¥é…ç½®æ–‡ä»¶
nano /etc/nginx/sites-available/ecommerce
```

### 9.2 ç«™ç‚¹æœªå¯ç”¨

```bash
# æ£€æŸ¥è½¯é“¾æ¥
ls -la /etc/nginx/sites-enabled/

# åˆ›å»ºè½¯é“¾æ¥
ln -s /etc/nginx/sites-available/ecommerce /etc/nginx/sites-enabled/

# é‡è½½ Nginx
systemctl reload nginx
```

### 9.3 é»˜è®¤ç«™ç‚¹å†²çª

```bash
# åˆ é™¤é»˜è®¤ç«™ç‚¹
rm /etc/nginx/sites-enabled/default

# é‡è½½ Nginx
systemctl reload nginx
```

---

## åã€systemd æœåŠ¡é—®é¢˜ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 10.1 æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
systemctl status ecommerce
journalctl -u ecommerce -n 50

# æ‰‹åŠ¨æµ‹è¯•å‘½ä»¤
sudo -u www-data /var/www/ecommerce_knowledge/venv/bin/gunicorn \
    -c gunicorn_config.py app:app
```

### 10.2 é…ç½®ä¿®æ”¹åä¸ç”Ÿæ•ˆ

```bash
# å¿…é¡»é‡æ–°åŠ è½½ systemd
systemctl daemon-reload

# ç„¶åé‡å¯æœåŠ¡
systemctl restart ecommerce
```

### 10.3 æœåŠ¡åå¤é‡å¯

```bash
# æŸ¥çœ‹é‡å¯åŸå› 
journalctl -u ecommerce --since "10 minutes ago"

# å¸¸è§åŸå› ï¼š
# - Python ä»£ç é”™è¯¯
# - å†…å­˜ä¸è¶³è¢« OOM æ€æ­»
# - ç«¯å£å†²çª
```

---

## åä¸€ã€æ•°æ®åº“é—®é¢˜ ğŸŸ¢ã€å¯é€‰ã€‘

### 11.1 SQLite æƒé™é—®é¢˜

```bash
# è®¾ç½®æ•°æ®åº“æ–‡ä»¶æƒé™
chmod 664 /var/www/ecommerce_knowledge/data/*.db
chown www-data:www-data /var/www/ecommerce_knowledge/data/*.db

# è®¾ç½®ç›®å½•æƒé™
chmod 775 /var/www/ecommerce_knowledge/data
chown www-data:www-data /var/www/ecommerce_knowledge/data
```

### 11.2 MySQL è¿æ¥é—®é¢˜

```bash
# æµ‹è¯•è¿æ¥
mysql -u user -p -h localhost

# æ£€æŸ¥æœåŠ¡
systemctl status mysql
```

---

## åäºŒã€ç½‘ç»œé—®é¢˜ ğŸŸ¡ã€é‡è¦ã€‘

### 12.1 æ— æ³•è®¿é—®æœåŠ¡å™¨

**æ’æŸ¥**
```bash
# æœ¬åœ° ping æµ‹è¯•
ping æœåŠ¡å™¨IP

# æ£€æŸ¥é˜²ç«å¢™
ufw status

# æ£€æŸ¥å®‰å…¨ç»„ï¼ˆè…¾è®¯äº‘æ§åˆ¶å°ï¼‰
```

### 12.2 åŸŸåæ— æ³•è§£æ

```bash
# DNS æŸ¥è¯¢
nslookup ä½ çš„åŸŸå.com

# ç­‰å¾… DNS ç”Ÿæ•ˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰
```

---

## ğŸ“‹ æ’æŸ¥å‘½ä»¤é€ŸæŸ¥

| é—®é¢˜ç±»å‹ | æ’æŸ¥å‘½ä»¤ |
|----------|----------|
| æœåŠ¡çŠ¶æ€ | `systemctl status ecommerce` |
| æœåŠ¡æ—¥å¿— | `journalctl -u ecommerce -f` |
| ç«¯å£ç›‘å¬ | `ss -tlnp` |
| è¿›ç¨‹æŸ¥çœ‹ | `ps aux \| grep gunicorn` |
| Nginx æ—¥å¿— | `tail -f /var/log/nginx/error.log` |
| é…ç½®æµ‹è¯• | `nginx -t` |
| æƒé™æ£€æŸ¥ | `ls -la /var/www/ecommerce_knowledge/` |
| ç£ç›˜ç©ºé—´ | `df -h` |
| å†…å­˜ä½¿ç”¨ | `free -h` |
| ç³»ç»Ÿè´Ÿè½½ | `top` æˆ– `htop` |

---

## ğŸ”§ å¿«é€Ÿä¿®å¤è„šæœ¬

```bash
#!/bin/bash
# fix_common_issues.sh - å¿«é€Ÿä¿®å¤å¸¸è§é—®é¢˜

echo "=== ä¿®å¤æƒé™ ==="
chown -R www-data:www-data /var/www/ecommerce_knowledge
chmod -R 755 /var/www/ecommerce_knowledge
mkdir -p /var/log/gunicorn
chown www-data:www-data /var/log/gunicorn

echo "=== é‡å¯æœåŠ¡ ==="
systemctl daemon-reload
systemctl restart ecommerce
systemctl restart nginx

echo "=== æ£€æŸ¥çŠ¶æ€ ==="
systemctl status ecommerce --no-pager
systemctl status nginx --no-pager

echo "=== æ£€æŸ¥ç«¯å£ ==="
ss -tlnp | grep -E "80|443|5000"

echo "=== å®Œæˆ ==="
```

---

*æ›´æ–°æ—¥æœŸï¼š2026-01-02*


