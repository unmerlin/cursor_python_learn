# æœåŠ¡å™¨éƒ¨ç½²å®Œæ•´æµç¨‹

> Flask é¡¹ç›®éƒ¨ç½²åˆ°è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨çš„å®Œæ•´æ­¥éª¤

---

## ğŸ“Œ çŸ¥è¯†ç‚¹è¯´æ˜

- ğŸ”´ **ã€å¿…é¡»æŒæ¡ã€‘** - éƒ¨ç½²å‰å¿…é¡»å®Œæˆ
- ğŸŸ¡ **ã€é‡è¦ã€‘** - éƒ¨ç½²åéœ€è¦å®Œæˆ
- ğŸŸ¢ **ã€å¯é€‰ã€‘** - åç»­ä¼˜åŒ–

---

## ä¸€ã€éƒ¨ç½²å‰å‡†å¤‡ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 1.1 æœåŠ¡å™¨è¦æ±‚

| é…ç½®é¡¹ | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|--------|----------|----------|
| CPU | 1æ ¸ | 2æ ¸ |
| å†…å­˜ | 1GB | 2GB |
| å­˜å‚¨ | 20GB | 40GB |
| å¸¦å®½ | 1Mbps | 3Mbps |
| ç³»ç»Ÿ | Ubuntu 20.04+ | Ubuntu 22.04 |

### 1.2 éœ€è¦å‡†å¤‡çš„ä¿¡æ¯

```
â–¡ æœåŠ¡å™¨å…¬ç½‘ IP åœ°å€
â–¡ æœåŠ¡å™¨ root å¯†ç ï¼ˆæˆ– SSH å¯†é’¥ï¼‰
â–¡ åŸŸåï¼ˆå·²å¤‡æ¡ˆï¼‰
â–¡ é¡¹ç›®æºä»£ç 
```

### 1.3 æœ¬åœ°é¡¹ç›®ç»“æ„ç¡®è®¤

```
ecommerce_knowledge/
â”œâ”€â”€ app.py                  # Flask åº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â”œâ”€â”€ static/                 # é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ templates/              # æ¨¡æ¿æ–‡ä»¶
â””â”€â”€ data/                   # æ•°æ®æ–‡ä»¶ï¼ˆå¦‚æœ‰ï¼‰
```

---

## äºŒã€è¿æ¥æœåŠ¡å™¨ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 2.1 SSH è¿æ¥

```bash
# Windows PowerShell æˆ– CMD
ssh root@ä½ çš„æœåŠ¡å™¨IP

# è¾“å…¥å¯†ç åè¿›å…¥æœåŠ¡å™¨

# é¦–æ¬¡è¿æ¥ä¼šæç¤ºç¡®è®¤æŒ‡çº¹ï¼Œè¾“å…¥ yes
```

### 2.2 é¦–æ¬¡ç™»å½•åæ›´æ–°ç³»ç»Ÿ

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
apt update

# å‡çº§å·²å®‰è£…è½¯ä»¶
apt upgrade -y
```

---

## ä¸‰ã€å®‰è£…å¿…è¦è½¯ä»¶ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 3.1 å®‰è£… Python å’Œå·¥å…·

```bash
# å®‰è£… Python3 å’Œç›¸å…³å·¥å…·
apt install python3 python3-pip python3-venv -y

# éªŒè¯å®‰è£…
python3 --version
pip3 --version
```

### 3.2 å®‰è£… Nginx

```bash
# å®‰è£… Nginx
apt install nginx -y

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
systemctl start nginx
systemctl enable nginx

# éªŒè¯è¿è¡Œ
systemctl status nginx
```

### 3.3 å®‰è£… Gitï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
apt install git -y
git --version
```

---

## å››ã€ä¸Šä¼ é¡¹ç›®ä»£ç  ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ SCPï¼ˆæ¨èæ–°æ‰‹ï¼‰

```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼ˆä¸æ˜¯æœåŠ¡å™¨ï¼‰
# ä¸Šä¼ é¡¹ç›®ç›®å½•åˆ°æœåŠ¡å™¨
scp -r C:\Users\ä½ çš„ç”¨æˆ·å\Desktop\ecommerce_knowledge root@æœåŠ¡å™¨IP:/var/www/

# ç¤ºä¾‹
scp -r C:\Users\Administrator\Desktop\cursor_python_learn\ecommerce_knowledge root@123.456.789.0:/var/www/
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ Gitï¼ˆæ¨èé•¿æœŸç»´æŠ¤ï¼‰

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /var/www

# å…‹éš†ä»“åº“
git clone https://github.com/ä½ çš„ç”¨æˆ·å/ecommerce_knowledge.git
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨ SFTP å·¥å…·

æ¨èå·¥å…·ï¼šFileZillaã€WinSCPã€MobaXterm

---

## äº”ã€é…ç½®é¡¹ç›®ç¯å¢ƒ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 5.1 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/ecommerce_knowledge

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# ç¡®è®¤æ¿€æ´»ï¼ˆå‘½ä»¤è¡Œå‰å‡ºç° (venv)ï¼‰
```

### 5.2 å®‰è£…ä¾èµ–

```bash
# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# å®‰è£… Gunicorn
pip install gunicorn
```

### 5.3 æµ‹è¯•åº”ç”¨

```bash
# ç®€å•æµ‹è¯•
python app.py

# å¦‚æœæ­£å¸¸è¿è¡Œï¼ŒæŒ‰ Ctrl+C åœæ­¢
```

---

## å…­ã€åˆ›å»º Gunicorn é…ç½® ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 6.1 åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
nano /var/www/ecommerce_knowledge/gunicorn_config.py
```

### 6.2 é…ç½®å†…å®¹

```python
# gunicorn_config.py
import multiprocessing

bind = "127.0.0.1:5000"
workers = multiprocessing.cpu_count() * 2 + 1
worker_class = "sync"
timeout = 120
accesslog = "/var/log/gunicorn/access.log"
errorlog = "/var/log/gunicorn/error.log"
loglevel = "info"
```

### 6.3 åˆ›å»ºæ—¥å¿—ç›®å½•

```bash
mkdir -p /var/log/gunicorn
chown www-data:www-data /var/log/gunicorn
```

---

## ä¸ƒã€åˆ›å»º systemd æœåŠ¡ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 7.1 åˆ›å»ºæœåŠ¡æ–‡ä»¶

```bash
nano /etc/systemd/system/ecommerce.service
```

### 7.2 æœåŠ¡é…ç½®

```ini
[Unit]
Description=Ecommerce Knowledge Website
After=network.target

[Service]
User=www-data
Group=www-data
WorkingDirectory=/var/www/ecommerce_knowledge
Environment="PATH=/var/www/ecommerce_knowledge/venv/bin"
ExecStart=/var/www/ecommerce_knowledge/venv/bin/gunicorn -c gunicorn_config.py app:app
ExecReload=/bin/kill -HUP $MAINPID
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

### 7.3 è®¾ç½®æƒé™

```bash
# è®¾ç½®é¡¹ç›®ç›®å½•æƒé™
chown -R www-data:www-data /var/www/ecommerce_knowledge
chmod -R 755 /var/www/ecommerce_knowledge
```

### 7.4 å¯åŠ¨æœåŠ¡

```bash
# é‡æ–°åŠ è½½ systemd
systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
systemctl start ecommerce

# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable ecommerce

# æ£€æŸ¥çŠ¶æ€
systemctl status ecommerce
```

---

## å…«ã€é…ç½® Nginx ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 8.1 åˆ›å»ºç«™ç‚¹é…ç½®

```bash
nano /etc/nginx/sites-available/ecommerce
```

### 8.2 é…ç½®å†…å®¹

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸå.com www.ä½ çš„åŸŸå.com;
    # å¦‚æœæ²¡æœ‰åŸŸåï¼Œä½¿ç”¨ï¼š
    # server_name ä½ çš„æœåŠ¡å™¨IP;
    
    charset utf-8;
    client_max_body_size 10M;
    
    location /static {
        alias /var/www/ecommerce_knowledge/static;
        expires 30d;
    }
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 8.3 å¯ç”¨ç«™ç‚¹

```bash
# åˆ›å»ºè½¯é“¾æ¥
ln -s /etc/nginx/sites-available/ecommerce /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤ç«™ç‚¹
rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
nginx -t

# é‡æ–°åŠ è½½
systemctl reload nginx
```

---

## ä¹ã€é…ç½®é˜²ç«å¢™å’Œå®‰å…¨ç»„ ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 9.1 æœåŠ¡å™¨é˜²ç«å¢™ï¼ˆUFWï¼‰

```bash
# å…è®¸å¿…è¦ç«¯å£
ufw allow 22     # SSH
ufw allow 80     # HTTP
ufw allow 443    # HTTPS

# å¯ç”¨é˜²ç«å¢™
ufw enable

# æŸ¥çœ‹çŠ¶æ€
ufw status
```

### 9.2 è…¾è®¯äº‘å®‰å…¨ç»„

1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. è¿›å…¥è½»é‡åº”ç”¨æœåŠ¡å™¨
3. é€‰æ‹©"é˜²ç«å¢™"
4. æ·»åŠ è§„åˆ™ï¼š
   - TCP 22ï¼ˆSSHï¼‰
   - TCP 80ï¼ˆHTTPï¼‰
   - TCP 443ï¼ˆHTTPSï¼‰

---

## åã€é…ç½®åŸŸå ğŸŸ¡ã€é‡è¦ã€‘

### 10.1 æ·»åŠ  DNS è§£æ

1. ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
2. è¿›å…¥åŸŸåç®¡ç†
3. é€‰æ‹©ä½ çš„åŸŸåï¼Œç‚¹å‡»"è§£æ"
4. æ·»åŠ è®°å½•ï¼š

| è®°å½•ç±»å‹ | ä¸»æœºè®°å½• | è®°å½•å€¼ | TTL |
|----------|----------|--------|-----|
| A | @ | æœåŠ¡å™¨IP | 600 |
| A | www | æœåŠ¡å™¨IP | 600 |

### 10.2 ç­‰å¾…è§£æç”Ÿæ•ˆ

```bash
# æµ‹è¯•è§£æï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰
ping ä½ çš„åŸŸå.com
```

---

## åä¸€ã€é…ç½® SSL/HTTPS ğŸŸ¡ã€é‡è¦ã€‘

### 11.1 å®‰è£… Certbot

```bash
apt install certbot python3-certbot-nginx -y
```

### 11.2 è·å–è¯ä¹¦

```bash
certbot --nginx -d ä½ çš„åŸŸå.com -d www.ä½ çš„åŸŸå.com
```

æŒ‰æç¤ºæ“ä½œï¼š
1. è¾“å…¥é‚®ç®±
2. åŒæ„æ¡æ¬¾
3. é€‰æ‹©æ˜¯å¦é‡å®šå‘ HTTP åˆ° HTTPSï¼ˆå»ºè®®é€‰æ˜¯ï¼‰

### 11.3 éªŒè¯è¯ä¹¦

```bash
# æµ‹è¯•ç»­æœŸ
certbot renew --dry-run
```

---

## åäºŒã€éƒ¨ç½²éªŒè¯æ¸…å• ğŸ”´ã€å¿…é¡»æŒæ¡ã€‘

### 12.1 æ£€æŸ¥æ¸…å•

```bash
# 1. æ£€æŸ¥ Gunicorn æœåŠ¡
systemctl status ecommerce
# æœŸæœ›: active (running)

# 2. æ£€æŸ¥ Nginx æœåŠ¡
systemctl status nginx
# æœŸæœ›: active (running)

# 3. æ£€æŸ¥ç«¯å£ç›‘å¬
ss -tlnp | grep -E "80|443|5000"
# æœŸæœ›: æ˜¾ç¤ºç›‘å¬ä¸­çš„ç«¯å£

# 4. æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://127.0.0.1:5000
# æœŸæœ›: è¿”å› HTML å†…å®¹

# 5. æµ‹è¯• Nginx ä»£ç†
curl http://127.0.0.1
# æœŸæœ›: è¿”å› HTML å†…å®¹
```

### 12.2 æµè§ˆå™¨æµ‹è¯•

- è®¿é—® `http://ä½ çš„åŸŸå.com`
- å¦‚æœé…ç½®äº† HTTPSï¼Œè®¿é—® `https://ä½ çš„åŸŸå.com`

---

## åä¸‰ã€æ—¥å¸¸ç»´æŠ¤å‘½ä»¤ ğŸŸ¡ã€é‡è¦ã€‘

### 13.1 æœåŠ¡ç®¡ç†

```bash
# é‡å¯åº”ç”¨
systemctl restart ecommerce

# é‡å¯ Nginx
systemctl restart nginx

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
journalctl -u ecommerce -f

# æŸ¥çœ‹ Nginx æ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

### 13.2 ä»£ç æ›´æ–°

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/ecommerce_knowledge

# å¦‚æœä½¿ç”¨ Git
git pull origin main

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# æ›´æ–°ä¾èµ–
pip install -r requirements.txt

# é‡å¯æœåŠ¡
systemctl restart ecommerce
```

---

## ğŸ“‹ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤æ±‡æ€»

```bash
# === ä¸€æ¬¡æ€§æ‰§è¡Œçš„å‘½ä»¤ ===

# 1. ç³»ç»Ÿå‡†å¤‡
apt update && apt upgrade -y
apt install python3 python3-pip python3-venv nginx git -y

# 2. é¡¹ç›®å‡†å¤‡
cd /var/www/ecommerce_knowledge
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pip install gunicorn

# 3. æƒé™è®¾ç½®
chown -R www-data:www-data /var/www/ecommerce_knowledge
mkdir -p /var/log/gunicorn
chown www-data:www-data /var/log/gunicorn

# 4. æœåŠ¡å¯åŠ¨
systemctl daemon-reload
systemctl start ecommerce
systemctl enable ecommerce
ln -s /etc/nginx/sites-available/ecommerce /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default
nginx -t && systemctl reload nginx

# 5. é˜²ç«å¢™
ufw allow 22 && ufw allow 80 && ufw allow 443
ufw enable

# 6. SSLï¼ˆå¯é€‰ï¼‰
apt install certbot python3-certbot-nginx -y
certbot --nginx -d your-domain.com
```

---

*æ›´æ–°æ—¥æœŸï¼š2026-01-02*


